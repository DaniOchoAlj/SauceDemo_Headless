# azure-pipelines.yml
# Ejecución de Tests Paralelos en Agentes de Windows

# 1. Trigger: Se activa automáticamente con un push a la rama 'main'
trigger:
- main

# 2. Variables para el modo de ejecución (Headless)
variables:
  headless_mode: 'true'

# 3. Jobs: Define la lista de trabajos
jobs:
- job: ParallelBrowserTests
  displayName: 'Ejecución Paralela de Tests'
  
  # Strategy: Define la matriz de ejecución
  strategy:
    matrix:
      Chrome_Tests:
        browser: 'chrome'
      Edge_Tests:
        browser: 'edge'

  # Pool: El agente (máquina virtual) donde se ejecutará el código
  pool:
    vmImage: 'windows-latest' # <--- ¡Cambiado a Windows!

  steps:
  
  # 3.1. Configuración de Java mediante Comando (Asume que Java ya existe)
  - task: CmdLine@2
    displayName: 'Verificar y Configurar Path de Java'
    inputs:
      script: |
        echo Buscando versión de Java...
        java -version
        # Nota: En los agentes de Windows, 'java' ya suele estar en el path.
        
  # 3.2. Ejecución del Comando Maven...
  - task: CmdLine@2
    displayName: 'Ejecutar Tests Maven en $(browser)'
    inputs:
      script: |
        echo Iniciando tests en $(browser) en modo Headless...
        # Maven ya debería encontrar el JDK configurado por el agente
        mvn clean install -Dbrowser=$(browser) -Dheadless=$(headless_mode)

  # 3.3. Publicación de Resultados (JUnit)
  # Esta tarea funciona igual en Windows y Linux
  - task: PublishTestResults@2
    displayName: 'Publicar Resultados de Tests'
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/surefire-reports/TEST-*.xml' 
      mergeTestResults: true
      testRunTitle: 'Resultados $(Browser) Headless'